

## Plano: Drill-Down como Mini-Dashboard AnalÃ­tico Completo

### DiagnÃ³stico da SituaÃ§Ã£o Atual

O que temos hoje:
- âœ… KPI cards simples no topo (nÃºmeros isolados)
- âœ… Tabela detalhada com alertas visuais
- âœ… Narrativas descritivas

**O que estÃ¡ faltando para ser um dashboard de verdade:**
- âŒ **GrÃ¡ficos visuais** que revelam padrÃµes e distribuiÃ§Ãµes
- âŒ **VisualizaÃ§Ã£o de ranking** (quem estÃ¡ performando melhor/pior)
- âŒ **Comparativos temporais** (evoluÃ§Ã£o ao longo do perÃ­odo)
- âŒ **SegmentaÃ§Ã£o visual** (por produto, por closer, por faixa)
- âŒ **Interatividade** (filtrar ao clicar em segmentos)

---

### A Nova ExperiÃªncia: Modal como Dashboard AnalÃ­tico

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "Propostas - Onde o Pipeline EstÃ¡ Travando?"                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚  â”‚ ğŸ“Š 12    â”‚  â”‚ ğŸ’° R$2.1Mâ”‚  â”‚ ğŸ¯ R$175kâ”‚  â”‚ âš ï¸ 4     â”‚  â”‚ ğŸ”´ R$800kâ”‚                  â”‚
â”‚  â”‚Propostas â”‚  â”‚ Pipeline â”‚  â”‚  Ticket  â”‚  â”‚Envelhecidâ”‚  â”‚ em Risco â”‚                  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   ğŸ“Š DistribuiÃ§Ã£o por Closer    â”‚  â”‚              ğŸ¯ Aging das Propostas          â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚                                              â”‚  â”‚
â”‚  â”‚   Pedro    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  R$ 800k  â”‚  â”‚   0-7d   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  6 (50%)    â”‚  â”‚
â”‚  â”‚   Daniel   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘  R$ 600k  â”‚  â”‚   8-14d  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  2 (17%)    â”‚  â”‚
â”‚  â”‚   Lucas    â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘  R$ 350k  â”‚  â”‚   15-30d â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  3 (25%)    â”‚  â”‚
â”‚  â”‚                                 â”‚  â”‚   30d+   â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  1 (8%) ğŸ”´  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“‹ 12 registros                                                 [ordenar por coluna]   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Empresa       â”‚ Valor   â”‚ MRR   â”‚ Closer â”‚ Dias â”‚ Data Envio â”‚ Pipefy            â”‚â”‚
â”‚  â”‚  ACME Corp     â”‚ R$ 350k â”‚ R$ 25kâ”‚ Pedro  â”‚ 45dğŸ”´â”‚ 15/12/2025 â”‚ ğŸ”—                â”‚â”‚
â”‚  â”‚  TechCo        â”‚ R$ 200k â”‚ R$ 15kâ”‚ Daniel â”‚ 32dğŸ”´â”‚ 28/12/2025 â”‚ ğŸ”—                â”‚â”‚
â”‚  â”‚  ...                                                                              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Componentes de VisualizaÃ§Ã£o a Criar

#### 1. `DrillDownBarChart` - GrÃ¡fico de Barras Horizontal para Rankings

Mostra distribuiÃ§Ã£o por dimensÃ£o (closer, produto, faixa de faturamento):
- Barras horizontais ordenadas por valor
- Cor indicando performance (verde = acima da mÃ©dia, vermelho = abaixo)
- ClicÃ¡vel para filtrar a tabela abaixo

**Uso por indicador:**
| Indicador | DimensÃ£o Principal | MÃ©trica |
|-----------|-------------------|---------|
| MQL | Faixa Faturamento | Quantidade |
| RM | Closer | Quantidade |
| RR | Closer | Taxa Show |
| Proposta | Closer | Valor Pipeline |
| Venda | Closer | Valor Total |
| SLA | SDR | SLA MÃ©dio |
| Faturamento | Closer | Valor |
| MRR | Closer | Valor MRR |

#### 2. `DrillDownProgressBars` - Barras de DistribuiÃ§Ã£o/Aging

Mostra distribuiÃ§Ã£o em faixas (aging, SLA ranges, faixas de valor):
- Barras segmentadas com cores (verde/amarelo/vermelho)
- Percentual e quantidade em cada faixa
- Visual imediato de onde estÃ£o os problemas

**Uso por indicador:**
| Indicador | DistribuiÃ§Ã£o |
|-----------|-------------|
| Proposta | Aging (0-7d, 8-14d, 15-30d, 30d+) |
| SLA | Tempo (< 30m, 30m-1h, 1h-2h, > 2h) |
| MQL | Tempo atÃ© Qualificar (1-3d, 4-7d, 8-14d, 14d+) |
| Venda | Ciclo de Venda (< 30d, 30-60d, 60-90d, > 90d) |

#### 3. `DrillDownPieChart` - GrÃ¡fico de Pizza para ComposiÃ§Ã£o

Mostra composiÃ§Ã£o percentual:
- Segmentos clicÃ¡veis para filtrar
- Legenda com valores absolutos

**Uso por indicador:**
| Indicador | ComposiÃ§Ã£o |
|-----------|-----------|
| Faturamento | MRR vs Setup vs Pontual |
| MQL | Por Produto (CaaS, O2 TAX, etc.) |
| Venda | Por Produto |

---

### ConfiguraÃ§Ã£o por Indicador

#### MQL - "De Onde VÃªm Nossos Melhores Leads?"

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Total, % Premium, Tempo MÃ©dio, Top SDR |
| GrÃ¡fico 1 | **Barras**: DistribuiÃ§Ã£o por Faixa Faturamento |
| GrÃ¡fico 2 | **Progress**: Tempo atÃ© Qualificar |
| Tabela | Lista completa |

#### RM - "Estamos Convertendo MQLs em ReuniÃµes?"

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Total, Taxa MQLâ†’RM, Tempo MÃ©dio, Top Closer |
| GrÃ¡fico 1 | **Barras**: Ranking de Closers (quantidade) |
| GrÃ¡fico 2 | **Progress**: Tempo como MQL antes de agendar |
| Tabela | Lista completa |

#### RR - "Quem Apareceu nas ReuniÃµes?"

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Realizadas, Taxa Show, No-Shows, Potencial |
| GrÃ¡fico 1 | **Barras**: Ranking de Closers (taxa show) |
| GrÃ¡fico 2 | **Progress**: Tempo entre agendar e realizar |
| Tabela | Lista completa |

#### Proposta - "Onde o Pipeline EstÃ¡ Travando?"

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Total, Pipeline, Ticket MÃ©dio, Envelhecidas, em Risco |
| GrÃ¡fico 1 | **Barras**: Pipeline por Closer (valor R$) |
| GrÃ¡fico 2 | **Progress**: Aging das Propostas (cores de alerta) |
| Tabela | Lista ordenada por aging |

#### Venda - "O Que Fechamos e Como?"

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Contratos, Total, % MRR, % Setup, Top Closer |
| GrÃ¡fico 1 | **Barras**: Ranking de Closers (valor R$) |
| GrÃ¡fico 2 | **Pizza**: ComposiÃ§Ã£o (MRR/Setup/Pontual) |
| Tabela | Lista ordenada por valor |

#### SLA - "Estamos Respondendo RÃ¡pido?"

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Leads, SLA MÃ©dio, % Meta, Mediana, Outliers |
| GrÃ¡fico 1 | **Barras**: SLA MÃ©dio por SDR |
| GrÃ¡fico 2 | **Progress**: DistribuiÃ§Ã£o de SLA (faixas de tempo) |
| Tabela | Lista ordenada por SLA (piores primeiro) |

#### Faturamento - "De Onde Veio o Dinheiro?"

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Total, % MRR, % Setup, % Pontual, vs Meta |
| GrÃ¡fico 1 | **Barras**: Faturamento por Closer |
| GrÃ¡fico 2 | **Pizza**: ComposiÃ§Ã£o MRR/Setup/Pontual |
| Tabela | Lista ordenada por valor |

#### MRR, Setup, Pontual

| SeÃ§Ã£o | VisualizaÃ§Ã£o |
|-------|--------------|
| KPIs | Contratos, Total, ARR/MÃ©dia, % do Fat., Maior |
| GrÃ¡fico 1 | **Barras**: Ranking por Closer |
| GrÃ¡fico 2 | **Progress**: ConcentraÃ§Ã£o (top 3 clientes vs resto) |
| Tabela | Lista ordenada por valor |

---

### SeÃ§Ã£o TÃ©cnica

#### Novos Arquivos a Criar

| Arquivo | DescriÃ§Ã£o |
|---------|-----------|
| `src/components/planning/indicators/DrillDownBarChart.tsx` | GrÃ¡fico de barras horizontais para rankings |
| `src/components/planning/indicators/DrillDownDistribution.tsx` | Barras de distribuiÃ§Ã£o/aging com cores |
| `src/components/planning/indicators/DrillDownPieChart.tsx` | GrÃ¡fico de pizza para composiÃ§Ã£o |
| `src/components/planning/indicators/DrillDownCharts.tsx` | Container que orquestra os grÃ¡ficos por indicador |

#### Arquivos a Modificar

| Arquivo | AlteraÃ§Ã£o |
|---------|-----------|
| `DetailSheet.tsx` | Adicionar prop `charts` com configuraÃ§Ã£o de grÃ¡ficos, renderizar Ã¡rea de grÃ¡ficos |
| `IndicatorsTab.tsx` | Configurar grÃ¡ficos especÃ­ficos para cada indicador nos handlers |

#### Interface de ConfiguraÃ§Ã£o de GrÃ¡ficos

```typescript
interface ChartConfig {
  type: 'bar' | 'distribution' | 'pie';
  title: string;
  data: ChartDataItem[];
}

interface ChartDataItem {
  label: string;
  value: number;
  color?: string;
  highlight?: 'success' | 'warning' | 'danger' | 'neutral';
}

interface DetailSheetProps {
  // ... existing props ...
  charts?: ChartConfig[];
}
```

#### Exemplo de ConfiguraÃ§Ã£o para Proposta

```typescript
case 'proposta': {
  // ... cÃ¡lculos existentes ...
  
  // Chart 1: Pipeline por Closer
  const closerTotals = new Map<string, number>();
  items.forEach(i => {
    const closer = i.responsible || 'Sem Closer';
    closerTotals.set(closer, (closerTotals.get(closer) || 0) + (i.value || 0));
  });
  const pipelineByCloser: ChartDataItem[] = Array.from(closerTotals.entries())
    .map(([label, value]) => ({ label, value }))
    .sort((a, b) => b.value - a.value);
  
  // Chart 2: Aging Distribution
  const agingBuckets = [
    { label: '0-7 dias', count: itemsWithAging.filter(i => (i.diasEmProposta || 0) <= 7).length, highlight: 'success' },
    { label: '8-14 dias', count: itemsWithAging.filter(i => (i.diasEmProposta || 0) > 7 && (i.diasEmProposta || 0) <= 14).length, highlight: 'neutral' },
    { label: '15-30 dias', count: itemsWithAging.filter(i => (i.diasEmProposta || 0) > 14 && (i.diasEmProposta || 0) <= 30).length, highlight: 'warning' },
    { label: '30+ dias', count: itemsWithAging.filter(i => (i.diasEmProposta || 0) > 30).length, highlight: 'danger' },
  ];
  
  const charts: ChartConfig[] = [
    { type: 'bar', title: 'Pipeline por Closer', data: pipelineByCloser },
    { type: 'distribution', title: 'Aging das Propostas', data: agingBuckets.map(b => ({ label: b.label, value: b.count, highlight: b.highlight })) },
  ];
  
  setDetailSheetCharts(charts);
  // ... resto do cÃ³digo ...
}
```

#### Componente DrillDownBarChart

```typescript
interface DrillDownBarChartProps {
  title: string;
  data: { label: string; value: number; highlight?: string }[];
  formatValue?: (value: number) => string;
}

export function DrillDownBarChart({ title, data, formatValue = String }: DrillDownBarChartProps) {
  const maxValue = Math.max(...data.map(d => d.value));
  
  return (
    <div className="space-y-3">
      <h4 className="text-sm font-medium text-foreground">{title}</h4>
      <div className="space-y-2">
        {data.slice(0, 5).map((item, index) => (
          <div key={item.label} className="flex items-center gap-3">
            <span className="text-sm text-muted-foreground w-20 truncate">{item.label}</span>
            <div className="flex-1 h-6 bg-muted rounded overflow-hidden">
              <div 
                className={cn(
                  "h-full rounded transition-all",
                  item.highlight === 'success' ? 'bg-green-500' :
                  item.highlight === 'danger' ? 'bg-red-500' :
                  item.highlight === 'warning' ? 'bg-amber-500' :
                  'bg-primary'
                )}
                style={{ width: `${(item.value / maxValue) * 100}%` }}
              />
            </div>
            <span className="text-sm font-medium w-24 text-right">{formatValue(item.value)}</span>
          </div>
        ))}
      </div>
    </div>
  );
}
```

#### Componente DrillDownDistribution

```typescript
interface DrillDownDistributionProps {
  title: string;
  data: { label: string; value: number; highlight?: string }[];
}

export function DrillDownDistribution({ title, data }: DrillDownDistributionProps) {
  const total = data.reduce((sum, d) => sum + d.value, 0);
  
  return (
    <div className="space-y-3">
      <h4 className="text-sm font-medium text-foreground">{title}</h4>
      <div className="space-y-2">
        {data.map((item) => {
          const pct = total > 0 ? (item.value / total) * 100 : 0;
          return (
            <div key={item.label} className="flex items-center gap-3">
              <span className="text-sm text-muted-foreground w-20">{item.label}</span>
              <div className="flex-1 h-4 bg-muted rounded overflow-hidden">
                <div 
                  className={cn(
                    "h-full rounded-l",
                    item.highlight === 'success' ? 'bg-green-500' :
                    item.highlight === 'danger' ? 'bg-red-500' :
                    item.highlight === 'warning' ? 'bg-amber-500' :
                    'bg-blue-500'
                  )}
                  style={{ width: `${pct}%` }}
                />
              </div>
              <span className="text-sm w-20 text-right">
                {item.value} ({Math.round(pct)}%)
              </span>
            </div>
          );
        })}
      </div>
    </div>
  );
}
```

---

### Resultado Final

Cada drill-down agora serÃ¡ um **mini-dashboard analÃ­tico** completo com:

1. **KPI Cards** - MÃ©tricas-chave destacadas visualmente
2. **GrÃ¡fico de Ranking** - Quem estÃ¡ performando melhor/pior
3. **GrÃ¡fico de DistribuiÃ§Ã£o** - Onde estÃ£o os problemas (aging, SLA, etc.)
4. **Tabela Detalhada** - Lista completa para anÃ¡lise granular

Isso transforma o clique no acelerÃ´metro de uma simples lista para uma **experiÃªncia analÃ­tica completa** que responde perguntas de negÃ³cio instantaneamente.

