

## Plano: Drill-Downs Estrat√©gicos - Insights que Guiam A√ß√£o

### Filosofia Central

Cada drill-down deve responder a **UMA pergunta estrat√©gica de neg√≥cio**, n√£o apenas listar dados. O objetivo √© transformar n√∫meros em **decis√µes**.

---

### Framework: Pergunta ‚Üí Insight ‚Üí A√ß√£o

| Indicador | Pergunta Estrat√©gica |
|-----------|---------------------|
| **MQL** | "Estamos captando leads com potencial real de convers√£o?" |
| **RM** | "Quem est√° convertendo MQLs em reuni√µes mais r√°pido?" |
| **RR** | "Quem apareceu vs. quem deu no-show, e por qu√™?" |
| **Proposta** | "Onde est√° travando? Quanto tempo at√© fechar?" |
| **Venda** | "Quem vendeu mais, o que vendeu, e em quanto tempo?" |
| **SLA** | "Quanto tempo at√© o primeiro contato? Quem est√° atrasando?" |
| **Faturamento** | "De onde veio o dinheiro? Qual o mix ideal?" |
| **MRR** | "Quanto de receita recorrente estamos construindo?" |
| **Setup** | "Quantas implanta√ß√µes e qual o esfor√ßo m√©dio?" |
| **Pontual** | "Receitas extraordin√°rias: oportunidade ou depend√™ncia?" |

---

### Os 10 Drill-Downs Redesenhados

---

#### 1. MQL - "Qualidade do Pipeline Entrante"

**Pergunta**: Estamos captando leads com potencial real?

**Descri√ß√£o Rica**:
```
X MQLs | Y% faixa premium (>R$50k) | M√©dia X dias para qualificar | Top SDR: Nome (X MQLs)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Identificar quem est√° entrando |
| Faixa Faturamento | **Qualidade do lead** - maior faixa = maior potencial |
| Dias at√© MQL | Velocidade de qualifica√ß√£o (Data Entrada MQL - Data Cria√ß√£o) |
| SDR | Quem qualificou - permite coaching |
| Setor | Padr√µes de mercado |

**Insight Visual na Descri√ß√£o**: "Y% faixa premium" responde imediatamente se estamos captando leads de qualidade.

---

#### 2. RM - "Efici√™ncia de Agendamento"

**Pergunta**: Quem est√° convertendo MQLs em reuni√µes mais r√°pido?

**Descri√ß√£o Rica**:
```
X reuni√µes | Taxa MQL‚ÜíRM: Y% | Tempo m√©dio at√© agendar: X dias | Top: Nome (X reuni√µes)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Quem vai reunir |
| Closer | Quem vai realizar a reuni√£o |
| Data Agendamento | Quando foi marcada |
| Dias como MQL | Quanto tempo demorou para evoluir - **gargalo vis√≠vel** |
| Faixa Faturamento | Priorizando certo? |

**Insight**: Se "Dias como MQL" √© alto, o gargalo est√° na prospec√ß√£o.

---

#### 3. RR - "Taxa de Comparecimento"

**Pergunta**: Quem compareceu vs. quem deu no-show?

**Descri√ß√£o Rica**:
```
X realizadas | Taxa show: Y% | Z no-shows | Melhor taxa: Nome (X%)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Quem reuniu |
| Closer | Quem conduziu |
| Data Reuni√£o | Quando aconteceu |
| Status | ‚úÖ Realizada (visual) |
| Faixa Faturamento | Estamos perdendo reuni√µes de alto potencial? |
| Tempo RM‚ÜíRR | Dias entre agendar e realizar - reuni√£o muito longe = no-show |

**Insight**: Taxa de show baixa pode indicar agendamentos muito distantes ou confirma√ß√£o fraca.

---

#### 4. Proposta - "Pipeline de Negocia√ß√£o"

**Pergunta**: Quanto est√° em jogo e onde est√° travando?

**Descri√ß√£o Rica**:
```
X propostas | Pipeline: R$ Xk | Ticket m√©dio: R$ Xk | Mais antiga: X dias (‚ö†Ô∏è Empresa Y)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Cliente em negocia√ß√£o |
| Valor Total | Tamanho do deal - prioriza√ß√£o |
| MRR | Quanto de recorr√™ncia |
| Closer | Quem est√° negociando |
| Dias em Proposta | **Aging** - propostas velhas morrem |
| Data Envio | Quando enviou |

**Insight**: Ordenar por "Dias em Proposta" decrescente revela deals travados que precisam de aten√ß√£o.

---

#### 5. Venda - "Celebra√ß√£o + An√°lise"

**Pergunta**: O que vendemos, quem vendeu, e quanto vale?

**Descri√ß√£o Rica**:
```
X contratos | Total: R$ Xk | MRR: R$ Xk (Y%) | Top Closer: Nome (R$ Xk)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Cliente conquistado - celebrar! |
| MRR | Receita recorrente constru√≠da |
| Setup | Implanta√ß√£o vendida |
| Pontual | Receita one-time |
| Total | Valor completo do contrato |
| Closer | Quem fechou - reconhecimento |
| Ciclo (dias) | Tempo Lead‚ÜíVenda - efici√™ncia do processo |

**Insight**: "Ciclo" mostra quanto tempo leva para converter - otimiza√ß√£o de processo.

---

#### 6. SLA - "Velocidade de Primeiro Contato"

**Pergunta**: Estamos respondendo r√°pido? Quem est√° atrasando?

**Descri√ß√£o Rica**:
```
X leads | SLA m√©dio: Xm | Dentro da meta (<30m): Y% | Mediana: Xm | Pior: Xh (‚ö†Ô∏è Nome)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Lead que esperou |
| Tempo SLA | Quantos minutos at√© contato - **m√©trica principal** |
| Status | ‚úÖ <30m / ‚ö†Ô∏è 30m-1h / üî¥ >1h (visual) |
| Data Cria√ß√£o | Quando o lead entrou |
| Data 1¬™ Tentativa | Quando foi contatado |
| SDR | Quem atendeu - coaching |

**Insight**: Ordenar por Tempo SLA decrescente revela os leads mais negligenciados.

---

#### 7. Faturamento - "Composi√ß√£o da Receita"

**Pergunta**: De onde veio o dinheiro? Qual o mix?

**Descri√ß√£o Rica**:
```
Total: R$ Xk | MRR: R$ Xk (Y%) | Setup: R$ Xk (Y%) | Pontual: R$ Xk (Y%) | vs Meta: X%
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | De quem veio |
| MRR | Parte recorrente |
| Setup | Parte de implanta√ß√£o |
| Pontual | Parte one-time |
| Total | Valor completo |
| % do Total | Peso deste contrato no faturamento geral |
| Closer | Quem trouxe |

**Insight**: Coluna "% do Total" mostra concentra√ß√£o de receita - risco se poucos clientes representam muito.

---

#### 8. MRR - "Constru√ß√£o de Base Recorrente"

**Pergunta**: Quanto de receita recorrente estamos adicionando?

**Descri√ß√£o Rica**:
```
X contratos com MRR | Total MRR: R$ Xk/m√™s | ARR projetado: R$ XM | Maior: R$ Xk (Empresa)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Cliente gerando recorr√™ncia |
| MRR | **Valor principal** - destacado |
| % do MRR Total | Concentra√ß√£o de receita recorrente |
| Produto | Qual BU est√° gerando |
| Closer | Quem vendeu |
| Data | Quando fechou |

**Filtro Impl√≠cito**: Apenas vendas com MRR > 0

**Insight**: ARR (MRR √ó 12) na descri√ß√£o mostra impacto anual da base constru√≠da.

---

#### 9. Setup - "Projetos de Implanta√ß√£o"

**Pergunta**: Quantas implanta√ß√µes vendemos e de que tamanho?

**Descri√ß√£o Rica**:
```
X projetos | Total Setup: R$ Xk | M√©dia: R$ Xk | Maior: R$ Xk (Empresa) | X% do faturamento
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | Cliente em implanta√ß√£o |
| Setup | **Valor principal** |
| % do Setup Total | Peso deste projeto |
| MRR Associado | Este cliente tamb√©m gera recorr√™ncia? |
| Closer | Quem vendeu |
| Data | Quando fechou |

**Filtro Impl√≠cito**: Apenas vendas com Setup > 0

**Insight**: Setup alto sem MRR = projeto pontual. Setup + MRR alto = cliente de longo prazo.

---

#### 10. Pontual - "Receitas Extraordin√°rias"

**Pergunta**: Estamos dependendo de receitas n√£o recorrentes?

**Descri√ß√£o Rica**:
```
X ocorr√™ncias | Total: R$ Xk | M√©dia: R$ Xk | X% do faturamento | Maior: R$ Xk (Empresa)
```

**Colunas Estrat√©gicas**:
| Coluna | Por qu√™? |
|--------|----------|
| Empresa | De quem veio |
| Pontual | **Valor principal** |
| % do Pontual Total | Peso desta receita |
| MRR Associado | Este cliente tamb√©m √© recorrente? (sa√∫de) |
| Closer | Quem vendeu |
| Data | Quando aconteceu |

**Filtro Impl√≠cito**: Apenas vendas com Pontual > 0

**Insight**: "% do faturamento" alta em Pontual = risco de imprevisibilidade.

---

### Se√ß√£o T√©cnica

#### Novos Campos no `DetailItem`

```typescript
export interface DetailItem {
  // ... campos existentes ...
  
  // Novos campos calculados
  diasAteQualificar?: number;    // MQL: Data Entrada - Data Cria√ß√£o
  diasComoMQL?: number;          // RM: Data Entrada RM - Data Entrada MQL
  diasEmProposta?: number;       // Proposta: Hoje - Data Entrada Proposta
  cicloVenda?: number;           // Venda: Data Venda - Data Cria√ß√£o Lead
  taxaShowPessoa?: number;       // RR: % show do closer individual
  percentualTotal?: number;      // Monet√°rios: valor / total
  slaStatus?: 'ok' | 'warning' | 'danger'; // SLA: visual
  setor?: string;                // MQL: segmenta√ß√£o
}
```

#### Arquivos a Modificar

| Arquivo | Altera√ß√£o |
|---------|-----------|
| `src/components/planning/indicators/DetailSheet.tsx` | Adicionar novos campos ao `DetailItem`, criar formatadores para status visual |
| `src/components/planning/IndicatorsTab.tsx` | Refatorar `handleRadialCardClick` e `handleMonetaryCardClick` com l√≥gica espec√≠fica por indicador |
| `src/hooks/useModeloAtualAnalytics.ts` | Adicionar c√°lculos de m√©tricas agregadas (%, mediana, top performer) |

#### Implementa√ß√£o - handleRadialCardClick Refatorado

```typescript
const handleRadialCardClick = (indicator: IndicatorConfig) => {
  const items = getItemsForIndicator(indicator.key);
  
  switch (indicator.key) {
    case 'mql': {
      // Calculate aggregates
      const premiumCount = items.filter(i => isPremiumFaixa(i.revenueRange)).length;
      const premiumPct = items.length > 0 ? Math.round((premiumCount / items.length) * 100) : 0;
      const avgDiasQualificar = calcAvgDiasQualificar(items);
      const topSDR = findTopPerformer(items, 'responsible');
      
      setDetailSheetTitle('MQL - Qualidade do Pipeline');
      setDetailSheetDescription(
        `${items.length} MQLs | ${premiumPct}% faixa premium | M√©dia ${avgDiasQualificar}d para qualificar | Top: ${topSDR.name} (${topSDR.count})`
      );
      setDetailSheetColumns([
        { key: 'company', label: 'Empresa' },
        { key: 'revenueRange', label: 'Faixa Faturamento', format: columnFormatters.revenueRange },
        { key: 'diasAteQualificar', label: 'Dias at√© MQL', format: (v) => `${v}d` },
        { key: 'responsible', label: 'SDR' },
        { key: 'setor', label: 'Setor' },
        { key: 'date', label: 'Data', format: columnFormatters.date },
      ]);
      break;
    }
    
    case 'proposta': {
      const pipeline = items.reduce((sum, i) => sum + (i.value || 0), 0);
      const avgTicket = items.length > 0 ? pipeline / items.length : 0;
      const oldest = findOldestDeal(items);
      
      setDetailSheetTitle('Propostas - Pipeline em Negocia√ß√£o');
      setDetailSheetDescription(
        `${items.length} propostas | Pipeline: ${formatCompactCurrency(pipeline)} | Ticket m√©dio: ${formatCompactCurrency(avgTicket)} | Mais antiga: ${oldest.days}d (‚ö†Ô∏è ${oldest.company})`
      );
      setDetailSheetColumns([
        { key: 'company', label: 'Empresa' },
        { key: 'value', label: 'Valor Total', format: columnFormatters.currency },
        { key: 'mrr', label: 'MRR', format: columnFormatters.currency },
        { key: 'responsible', label: 'Closer' },
        { key: 'diasEmProposta', label: 'Dias em Proposta', format: formatAgingWithAlert },
        { key: 'date', label: 'Data Envio', format: columnFormatters.date },
      ]);
      break;
    }
    
    // ... similar para outros indicadores
  }
  
  setDetailSheetItems(items);
  setDetailSheetOpen(true);
};
```

#### Formatador Visual para Aging com Alerta

```typescript
const formatAgingWithAlert = (days: number) => {
  if (days > 30) return <span className="text-red-600 font-medium">{days}d üî¥</span>;
  if (days > 14) return <span className="text-amber-600">{days}d ‚ö†Ô∏è</span>;
  return <span className="text-green-600">{days}d</span>;
};
```

#### Formatador Visual para SLA Status

```typescript
const formatSlaStatus = (minutes: number) => {
  if (minutes <= 30) return <Badge className="bg-green-100 text-green-800">‚úÖ {Math.round(minutes)}m</Badge>;
  if (minutes <= 60) return <Badge className="bg-amber-100 text-amber-800">‚ö†Ô∏è {Math.round(minutes)}m</Badge>;
  const hours = Math.floor(minutes / 60);
  const mins = Math.round(minutes % 60);
  return <Badge className="bg-red-100 text-red-800">üî¥ {hours}h{mins > 0 ? ` ${mins}m` : ''}</Badge>;
};
```

---

### Resultado Final

Cada drill-down agora:
1. **Responde uma pergunta** clara no t√≠tulo
2. **Mostra agregados** relevantes na descri√ß√£o (sem precisar contar)
3. **Destaca anomalias** com √≠cones visuais (‚ö†Ô∏è üî¥ ‚úÖ)
4. **Permite a√ß√£o** - saber quem cobrar, o que priorizar
5. **Aplica filtros impl√≠citos** - Monet√°rios mostram s√≥ vendas com valor > 0

